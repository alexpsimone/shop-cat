{% extends 'base.html' %}

{% block title %}Edit Procedure{% endblock %}

{% block js %}
    <script src="/static/js/write-procedure.js" type="text/jsx"></script>
    <script src="/static/js/edit-procedure.js" type="text/jsx"></script>
    <script src="http://code.jquery.com/jquery.js"></script>
{% endblock %}


{% block body %}

<form action="/rebuild-procedure", method="POST">
    <input name="proc_id" id="proc_id" type="number" value="{{ procedure.proc_id }}" style="display: none;"/>

    <h1>Title:</h1>
    <input type="text" name="title" id="title", value="{{ procedure.title }}" />

    <h1>Label (optional):</h1>
    {% if procedure.label %}
        <input type="text" name="label" id="label" value="{{ procedure.label }}" />
    {% else %}
        <input type="text" name="label" id="label" />
    {% endif %}
    <br />
    <input type="checkbox" name="label-remove" id="label-remove" />
    <label for="label-remove">Remove this label.</label>
    
    <br />
    <div id="cars">
    <input name="NUM_CARS" id="NUM_CARS" type="hidden" value="{{ num_cars }}" />
    <h1>Applicable Vehicles:</h1>
    <table>
        {% for proc_car in proc_car_obj %}
        <tr id="row-{{ proc_car.car.model_year }}-{{ proc_car.car.make }}-{{ proc_car.car.model }}">
            <td>
                <input name="cars" 
                        value="{{ proc_car.car.model_year }}-{{ proc_car.car.make }}-{{ proc_car.car.model }}" 
                        disabled />
            </td>
            <td>
                <button class="remove-car" 
                        value="{{ proc_car.car.model_year }}-{{ proc_car.car.make }}-{{ proc_car.car.model }}">
                        Remove
                </button>
            </td>
        </tr>
        {% endfor %}
    </table>

    <br />
    <button id="car-add">Add a Vehicle</button>
    </div>
   
    <br />
    <div id="tools">
        <h1>Required tools:</h1>
        <button id="tool-add">Add a Tool</button>
        <input name="NUM_TOOLS" id="NUM_TOOLS" type="hidden" value="{{ num_tools }}" />
        <table>
            {% for proc_tool in proc_tool_obj %}
            <tr id="row-{{ proc_tool.tool.name }}">
                <td>
                    <input name="tool" value="{{ proc_tool.tool.name }}" disabled />
                </td>
                <td>
                    <button class="remove-tool" value="{{ proc_tool.tool.name }}">Remove</button>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <br />
    <div id="parts">
        <input name="NUM_PARTS" id="NUM_PARTS" type="hidden" value="{{ num_parts }}" />
        <h1>Required parts:</h1>
        <button id="part-add">Add a Part</button>
        <input name="NUM_PARTS" id="NUM_PARTS" type="hidden" value="{{ num_parts }}" />
        <table>
            {% for proc_part in proc_part_obj %}
            <tr id="row-{{ proc_part.part.name }}">
                <td>
                    <input name="parts" value="{{ proc_part.part.name }}" disabled />
                </td>
                <td>
                    <button class="remove-part" value="{{ proc_part.part.name }}">Remove</button>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <br />
    <div id="steps">
        <input name="NUM_STEPS" id="NUM_STEPS" type="hidden" value="{{ num_steps }}" />
        <h1>Procedure Steps:</h1>
        <button id="step-add">Add a Step</button>
        <table>
            {% for n in range(num_steps) %}
            <tr id="row-{{ steps[n].step_id }}">
                <td>
                    <input id="order-{{ steps[n].step_id }}" name="step-order" value="{{ n + 1 }}" disabled />
                    <br />
                    <button class="move-up" value="{{ steps[n].step_id }}">UP</button>
                    <button class="move-down" value="{{ steps[n].step_id }}">DOWN</button>
                </td>
                <td>
                    <input name="step_text" value="{{ steps[n].step_text }}" />
                </td>
                <td>
                    <input name="step_ref" value="{{ steps[n].reference }}" disabled />
                    <br />
                    <button class="edit-ref" value="{{ steps[n].step_id }}">Edit Ref</button>
                    <button class="del-ref" value="{{ steps[n].step_id }}">Remove Ref</button>
                </td>
                <td>
                    <input name="step_img" value="{{ steps[n].step_img }}" disabled />
                    <br />
                    <button class="edit-img" value="{{ steps[n].step_id }}">Edit Img</button>
                    <button class="del-img" value="{{ steps[n].step_id }}">Remove Img</button>
                </td>
                <td>
                    <button class="remove-step" value="{{ steps[n].step_id }}">Remove Step</button>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <br />
    <input type="submit">
</form>

<br />
<a href="/home">Return Home</a>

<form id="car-add-form" action="/vehicle-select" method="POST" style="display: none;">
    <label>Car Model Year:</label>
    <input id="model-year" name="model-year" type="number" min="1900" max="2020" />
    <br />
    <label>Car Make:</label>
    <select id="make" name="make">
    <option value="">--Please select a Make--</option>
    {% for make in sorted_makes %}
    <option value="{{ make }}">{{ make }}</option>
    {% endfor %}
    <option value="other">Other (please specify)...</option>
    </select>
    <br />
    <label>Car Model:</label>
    <select id="model-select" name="model" disabled>
    <option value="">--Please select a Model--</option>
    </select>
    <br />
    <input id="vehicle-submit" type="submit" disabled>
</form>

{% endblock %}